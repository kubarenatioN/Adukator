<app-back-btn>Назад</app-back-btn>

<form class="filters" [formGroup]="filtersForm">
	<label>
		<mat-form-field>
			<mat-label>Тренинг</mat-label>
			<mat-select formControlName="training">
				<mat-option
					*ngFor="let training of trainings" 
					[value]="training._id"
				>
					{{ training.course.title }}
				</mat-option>
			</mat-select>
		</mat-form-field>

	</label>
	<label>
		<mat-form-field *ngIf="profiles$ | async as profiles; else noTrainingProfiles">
			<mat-label>Студент</mat-label>
			<mat-select formControlName="student" multiple>
				<mat-option
					*ngFor="let profile of profiles" 
					[value]="profile.uuid"
				>
					{{ profile.student.username }}
				</mat-option>
			</mat-select>
		</mat-form-field>
	</label>
</form>

<ng-container *ngIf="viewData$ | async as viewData; else loader">
	<ng-container
		[ngTemplateOutlet]="profileInfo"
		[ngTemplateOutletContext]="{
			viewData,
			charts: viewData.charts
		}"
	></ng-container>
</ng-container>

<ng-template
	#profileInfo
	let-charts="charts"
>
	<h2>Прогресс по тренингу</h2>

	<div class="progress">
		<app-topics-progress-chart
			[config]="charts.topics"
		></app-topics-progress-chart>
	</div>

</ng-template>

<ng-template #loader>
	<p>Loading profile data...</p>
</ng-template>

<ng-template #noAccess>
	<p>No access to profile.</p>
</ng-template>

<ng-template #noTrainingProfiles>
	<p>на тренинге нет студентов.</p>
</ng-template>
